extends layout

mixin followLink(username)
    - const pagePart = page < 2 ? '' : `?p=${page}`
    - const goto = encodeURIComponent(`${base_url}${pagePart}`)
    a(href=`/following?follow=${username}&goto=${goto}` class="follow" title=`follow ${username}`) +

mixin unfollowLink(username)
    - const pagePart = page < 2 ? '' : `?p=${page}`
    - const goto = encodeURIComponent(`${base_url}${pagePart}`)
    a(href=`/following?unfollow=${username}&goto=${goto}` class="unfollow" title=`unfollow ${username}`) -

block content
    if posts.length
        .posts

            each post in posts
                div
                    if post.is_visible
                        if post.link === null
                            a(href=`/p/${post.public_id}`) #{post.title}
                        else
                            a(href=post.link)= post.title

                        | 
                        span(class="puser") by #{post.username}
                        if post.user_id != user.user_id
                            +unfollowLink(post.username)
                        | 
                        span(class="pdate") on #{post.created_on}

                        if post.tags.length
                            | 
                            |to
                            each tag in post.tags
                                | 
                                a(href=`/r/${tag}` class="tag1")=tag

                        | 
                        a(href=`/p/${post.public_id}`) comments(#{post.num_comments})
                    else
                        +followLink(post.username)
                        | 
                        span(class="pdate") on #{post.created_on}
                        | 
                        a(href=`/p/${post.public_id}`) comments(#{post.num_comments})
        div
            a(href=`${base_url}?p=${page + 1}`) more
    else
        span no posts
